<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registrar Tarea</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />

    <!-- Font Awesome -->
    <script
      src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"
      crossorigin="anonymous"
    ></script>

    <!-- Fuente -->
    <link
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700"
      rel="stylesheet"
    />

    <link rel="stylesheet" th:href="@{/css/register.css}" />
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Gestor de Tareas</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon text-light"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="/">Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/tareas">Tareas</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header>
      <div class="container">
        <h1>Registrar / Editar Tarea</h1>
        <p>Completa los campos para crear o actualizar una tarea</p>
      </div>
    </header>

    <!-- Formulario -->
    <div class="form-container">
      <form th:action="@{/registrar}" th:object="${tarea}" method="post">
        <div class="mb-3">
          <label for="titulo">TÃ­tulo</label>
          <input
            type="text"
            class="form-control"
            id="titulo"
            placeholder="Ej. ReuniÃ³n con el equipo"
            th:field="*{titulo}"
            required
          />
        </div>

        <div class="mb-3">
          <label for="descripcion">DescripciÃ³n</label>
          <textarea
            class="form-control"
            id="descripcion"
            rows="3"
            placeholder="Describe los detalles de la tarea..."
            th:field="*{descripcion}"
            required
          ></textarea>
        </div>

        <div class="mb-3">
          <label for="estado">Estado</label>
          <select class="form-select" id="estado" th:field="*{estado}" required>
            <option value="">Seleccione un estado...</option>
            <option value="Pendiente">Pendiente</option>
            <option value="En progreso">En progreso</option>
            <option value="Completado">Completado</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="fecha">Fecha lÃ­mite</label>
          <input
            type="date"
            class="form-control"
            id="fecha"
            th:field="*{fecha}"
            required
          />
        </div>

        <div class="d-flex justify-content-between">
          <a href="/tareas" class="btn btn-secondary mb-5 px-4">
            <i class="fa-solid fa-arrow-left me-2"></i>Volver
          </a>
          <button type="submit" class="btn btn-primary mb-5 px-4">
            <span th:text="${tarea.id != null} ? 'Actualizar' : 'Registrar'"
              >Registrar</span
            >
          </button>
        </div>
      </form>
    </div>
    <!-- Toast de actualizaciÃ³n exitosa -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
      <div
        id="updateToast"
        class="toast align-items-center text-white bg-info border-0"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="d-flex">
          <div class="toast-body">Â¡Tarea actualizada con Ã©xito!</div>
          <button
            type="button"
            class="btn-close btn-close-white me-2 m-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <p class="mb-0">
        &copy; 2025 Gestor de Tareas | Desarrollado por Manito ðŸ’ª
      </p>
    </footer>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get("updated") === "true") {
          const toastEl = document.getElementById("updateToast");
          const toast = new bootstrap.Toast(toastEl);
          toast.show();
        }
      });
    </script>
  </body>
</html>
